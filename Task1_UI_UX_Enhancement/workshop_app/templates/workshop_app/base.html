<!DOCTYPE html>
<html lang="en">
{% load static %}
{% load custom_filters %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light">
    <meta name="theme-color" content="#2563eb">
    <meta name="description" content="FOSSEE Workshop Booking System - Modern workshop management platform">
    <link rel="icon" type="image/svg+xml" href="{% static 'workshop_app/img/favicon.svg' %}">
    <link rel="shortcut icon" href="{% static 'workshop_app/img/favicon.svg' %}">
    <title>
        {% block title %}
            FOSSEE Workshops
        {% endblock %}
    </title>

    <script src="{% static 'workshop_app/js/jquery-3.4.1.min.js' %}"></script>
    <script src="{% static 'workshop_app/js/popper.min.js' %}"></script>
    <script src="{% static 'workshop_app/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'workshop_app/js/toastr.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    {% block extra-dependencies %}
    {% endblock %}

    <!-- Modern CSS Framework -->
    <link rel="stylesheet" href="{% static 'workshop_app/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'workshop_app/css/toastr.min.css' %}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'workshop_app/css/base.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'workshop_app/css/theme.css' %}?v=2" type="text/css"/>
    <link rel="stylesheet" href="{% static 'workshop_app/css/font-awesome.css' %}" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">

    {% block extra-custom-scripts %}
    {% endblock %}

</head>

<body>
{% block header %}
    <nav class="navbar navbar-dark navbar-expand-lg bg-dark fixed-top">
        <div class="container">
            {% if user.is_authenticated %}
            <a class="navbar-brand" href="{% url 'workshop_app:index' %}">
                <i class="material-icons" style="vertical-align: middle; margin-right: 8px;">school</i>
                FOSSEE Workshops
            </a>
            {% else %}
            <a class="navbar-brand" href="{{request.scheme}}://{{request.get_host}}">
                <i class="material-icons" style="vertical-align: middle; margin-right: 8px;">school</i>
                FOSSEE Workshops
            </a>
            {% endif %}
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarSupportedContent">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{% if user.is_authenticated %}{% url 'workshop_app:workshop_status_instructor' %}{% else %}/{% endif %}" data-active-exact="/,/workshop/status">
                        <i class="material-icons" style="vertical-align: middle; margin-right: 4px; font-size: 18px;">home</i>
                        Home
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'statistics_app:public' %}">
                        <i class="material-icons" style="vertical-align: middle; margin-right: 4px; font-size: 18px;">analytics</i>
                        Statistics
                    </a>
                </li>
            </ul>
            {% if user.is_authenticated %}
            <ul class="navbar-nav mr-auto">
                {% if request.user|has_group:"instructor" %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'statistics_app:team' %}">
                        <i class="material-icons" style="vertical-align: middle; margin-right: 4px; font-size: 18px;">group</i>
                        Team Stats
                    </a>
                </li>
                {% endif %}
                
                {% if not request.user|has_group:"instructor" %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'workshop_app:propose_workshop' %}" data-active-prefix="/workshop/propose">
                            <i class="material-icons" style="vertical-align: middle; margin-right: 4px; font-size: 18px;">add_circle</i>
                            Propose Workshop
                        </a>
                    </li>
                {% endif %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'workshop_app:workshop_type_list' %}" data-active-prefix="/workshop/types">
                        <i class="material-icons" style="vertical-align: middle; margin-right: 4px; font-size: 18px;">category</i>
                        Workshop Types
                    </a>
                </li>
            </ul>
            <div class="my-2 my-lg-0">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                           <i class="material-icons" style="vertical-align: middle; margin-right: 4px;">account_circle</i>
                           <span>{{user.get_full_name|title}}</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="{% url 'workshop_app:view_own_profile' %}">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 8px; font-size: 18px;">person</i>
                                Profile
                            </a>
                            <a class="dropdown-item" href="{% url 'password_change' %}">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 8px; font-size: 18px;">lock</i>
                                Change Password
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="{% url 'workshop_app:logout' %}">
                                <i class="material-icons" style="vertical-align: middle; margin-right: 8px; font-size: 18px;">logout</i>
                                Logout
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
            {% endif %}
        </div>
        </div>
    </nav>
{% endblock %}

<div class="base-content">
    {% block content %}
        <h1>Base Template Content. Please override me</h1>
    {% endblock %}
</div>

<script>
    // Progressive enhancement for forms and tables (no backend changes)
    document.addEventListener('DOMContentLoaded', function () {
        try {
            var inputs = document.querySelectorAll('input[type="text"], input[type="password"], input[type="email"], select, textarea');
            inputs.forEach(function (el) { el.classList.add('form-control'); });

            var tables = document.querySelectorAll('table');
            tables.forEach(function (t) {
                t.classList.add('table', 'table-striped', 'table-hover');
                var p = t.parentElement;
                if (!p || !p.classList || !p.classList.contains('table-responsive')) {
                    var wrap = document.createElement('div');
                    wrap.className = 'table-responsive';
                    if (t.parentNode) {
                        t.parentNode.insertBefore(wrap, t);
                        wrap.appendChild(t);
                    }
                }
            });
        } catch (e) { /* no-op */ }
    });
</script>

<script>
    // Collapse navbar after clicking a link (better mobile UX)
    document.addEventListener('DOMContentLoaded', function () {
        var nav = document.getElementById('navbarSupportedContent');
        if (!nav) return;
        nav.querySelectorAll('a.nav-link').forEach(function (link) {
            link.addEventListener('click', function (e) {
                // Ignore dropdown toggles; let Bootstrap handle them
                var isDropdownToggle = link.classList.contains('dropdown-toggle') || link.getAttribute('data-toggle') === 'dropdown';
                if (isDropdownToggle) { return; }
                var coll = $('.navbar-collapse');
                if (coll && coll.hasClass('show')) { coll.collapse('hide'); }
            });
        });
        // Ensure dropdowns initialize on mobile
        if (typeof $ !== 'undefined' && $.fn && $.fn.dropdown) {
            $('.dropdown-toggle').dropdown();
        }
        // Mark current path as active if matches href or any of the data-active-prefix entries
        var path = window.location.pathname.replace(/\/$/, '') || '/';
        nav.querySelectorAll('a.nav-link').forEach(function (link) {
            var href = link.getAttribute('href') || '';
            var prefixes = (link.getAttribute('data-active-prefix') || '').split(',').filter(Boolean);
            var exacts = (link.getAttribute('data-active-exact') || '').split(',').filter(Boolean);
            var isExact = href === path;
            // Avoid marking Home active for every subpath; ignore "/" as a prefix
            var isPrefix = prefixes
                .filter(function (p) { return p && p !== '/'; })
                .some(function (p) { return path.indexOf(p) === 0; });
            var isExactList = exacts.some(function (p) { return path === p; });
            if (isExact || isPrefix || isExactList) {
                var li = link.closest('.nav-item');
                if (li) { li.classList.add('active'); }
            }
        });
    });
    </script>
    {% if messages %}
        {% for message in messages %}
            toastr[{% if message.tags %} "{{ message.tags }}" {% else %} "info" {% endif %}]("{{ message }}");
        {% endfor %}
    {% endif %}
</script>

    <footer class="footer">
        {% block footer %}
           <div class="container">
               <p class="mb-0 text-center">Developed by <strong>FOSSEE Group, IIT Bombay</strong></p>
           </div> 
        {% endblock %}
    </footer>
</body>
</html>
